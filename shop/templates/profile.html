{% block content %}
     {% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<style>
.outer-table {
    font-family: 'Open Sans', Helvetica;
    color: #efefef; /* Default text color */
    margin: 0 auto;
    width: 98%;


}
.outer-table th:first-child {
  border-top-left-radius: 15px;
}

.outer-table th:last-child {
  border-top-right-radius: 15px;
}
.outer-table tr:last-child td:first-child {
  border-bottom-left-radius: 15px;
}

.outer-table tr:last-child td:last-child {
  border-bottom-right-radius: 15px;
}
.outer-table tr:nth-child(2n+3) {
  background: #fff;
}

.outer-table th, .outer-table td {
  padding: 1em;
  width: 10em;
}

.outer-table th, .outer-table .tr-outer .td-outer:first-child, .nested-table-row .td-outer:first-child{
  background: #103179;
  color: #efefef;
}

 .outer-table td:not(:first-child) {
  color: #464646;
}


 {#{  HERE  }#}

 .nested-table {
  font-family: 'Open Sans', Helvetica;
  color: #efefef; /* Default text color */
}

.nested-table tr:nth-child(2n) {
  background: #ecfffe; /* Even rows background */
}

.nested-table{
    width: 100%;
}
.nested-table th, .nested-table td {
  padding: 1em;
  width: 10em;
}
.outer-table .td-outer:first-child {
  width: 40px; /* Or any fixed width you prefer */
}
.outer-table th:first-child {
  width: 40px; /* Or any fixed width you prefer */
}
.nested-table th {
  background: #364ca2;
  color: #efefef;
}
.nested-table tr:nth-child(2n+1) {
  background: #e4ecff !important; /* Odd rows background, starting from the third */
}
.nested-table tr td:first-child {
  {#background: #000;#}
  color: #2d2d2d;
}
</style>
<body>
{% include 'base.html' %}
<h1 style="font-weight: 700"> {{ user.username }} </h1>
<hr>
{% if user.username == 'westa_admin' %}
    <h2 > Account role: admin </h2>
    {% else %}
    <h3> Account role: user</h3>
{% endif %}
<hr>
<h1 style="text-align: center"> Order history </h1>
<table class="outer-table" id="table-{{ user.email }}" style="border:1px solid" >
      <tr>
          <th> Order ID </th>
          <th> Products </th>
          <th> Date </th>
          <th> Status </th>
          <th> Total </th>
      </tr>
      {% for document in orders %}
          <div class="cart-icon" id="cart-icon">
              <tr class="tr-outer" id="content-{{ document.order_id }}">
                  <td class="td-outer">{{ document.order_id }}</td>
                  <td class="td-outer">
                      <span><i class="fa fa-arrow-right" id="arrow-icon-{{ document.order_id }}" aria-hidden="true"></i> <a data-order-id="{{ document.order_id }}" class="show-content" id="show-button-{{ document.order_id }}">Show</a></span>
                  </td>
                  <td class="td-outer">{{ document.date }}</td>
                  <td class="td-outer">{{ document.Status }}</td>
                  <td class="td-outer">€{{ document.sum }}</td>
              </tr>

          </div>
    {% endfor %}
</table>
</body>
<script>
let products = [];
document.addEventListener("DOMContentLoaded", function() {
    products = {{ products|safe }};
});
document.querySelectorAll('.show-content').forEach(button => {
    button.addEventListener('click', () => {
        let orderId = button.getAttribute('data-order-id');
        let arrow = document.getElementById('arrow-icon-' + orderId);
        var orderRow = document.getElementById('content-' + orderId);
        var table = orderRow.closest('table');
        var rowIndex = orderRow.rowIndex;

        var nextRow = table.rows[rowIndex + 1];
        if (nextRow && nextRow.classList.contains('nested-table-row')) {

            table.deleteRow(rowIndex + 1);
            arrow.classList.remove('fa-arrow-down');
            arrow.classList.add('fa-arrow-right');
            document.getElementById('show-button-' + orderId).innerText = "Show";
        } else {
            arrow.classList.remove('fa-arrow-right');
            arrow.classList.add('fa-arrow-down');
            document.getElementById('show-button-' + orderId).innerText = "Hide";

            // Insert new row for nested table
            var nestedTableRow = table.insertRow(rowIndex + 1);
            nestedTableRow.classList.add('nested-table-row');

            // Create first cell for indentation
            var indentCell = nestedTableRow.insertCell(0);
            indentCell.classList.add('td-outer');

            // Create second cell for the nested table
            var nestedTableCell = nestedTableRow.insertCell(1);
            nestedTableCell.colSpan = "4"; // Span the rest of the columns as needed

            // Create and insert the nested table
            var nestedTable = document.createElement('table');
            nestedTable.classList.add('nested-table'); // Add this line to differentiate the nested tables
            {#let products = JSON.parse('{{ products|safe }}');#}
            var nestedTableContent = `
                <tr>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Price</th>
                    <th>Quantity</th>
                </tr>`;
            {#console.log((products));#}
            products[orderId].forEach(function(product) {
                nestedTableContent += `
                    <tr>
                        <td>${product.name}</td>
                        <td>${product.description}</td>
                        <td>€${product.price}</td>
                        <td>${product.quantity}</td>
                    </tr>`;
            });
            nestedTable.innerHTML = nestedTableContent;
            nestedTableCell.appendChild(nestedTable);
        }
    }); // This closing parenthesis was missing
});

</script>
</html>

{% endblock %}

