{% block content %}
     {% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<style>

 th{
        border: 1px solid;
    }

    td{
        border: 1px solid;
    }
    .indent-cell {
    padding-left: 50px; /* Adjust this value as needed for the indentation */
}
</style>
<body>
{% include 'base.html' %}
<h1 style="font-weight: 700"> {{ user.username }} </h1>
<hr>
{% if user.username == 'westa_admin' %}
    <h2 > Account role: admin </h2>
    {% else %}
    <h3> Account role: user</h3>
{% endif %}
<hr>
<h1> Order history </h1>
<table id="table-{{ user.email }}" style="border:1px solid" >
<tr>

    <th> Order ID </th>
    <th> Products </th>
    <th> Date </th>
    <th> Status </th>
    <th> Total </th>
</tr>
      {% for document in orders %}
    <div class="cart-icon" id="cart-icon">



        <tr id="content-{{ document.order_id }}">
              <td>
        {{ document.order_id }}
    </td>
            <td>
                <span ><i class="fa fa-arrow-right" id="arrow-icon-{{ document.order_id }}" aria-hidden="true"></i> <a data-order-id="{{ document.order_id }}" class="show-content" id="show-button-{{ document.order_id }}">Show</a></span>
            </td>
    <td>
        {{ document.date }}
    </td>
    <td>
        {{ document.Status }}
    </td>
    <td>
        €{{ document.sum }}
    </td>
</tr>

    </div>
    {% endfor %}
</table>
</body>
<script>
let products = [];
document.addEventListener("DOMContentLoaded", function() {
    products = {{ products|safe }};
});
document.querySelectorAll('.show-content').forEach(button => {
    button.addEventListener('click', () => {
        let orderId = button.getAttribute('data-order-id');
        let arrow = document.getElementById('arrow-icon-' + orderId);
        var orderRow = document.getElementById('content-' + orderId);
        var table = orderRow.closest('table');
        var rowIndex = orderRow.rowIndex;

        // Check if the nested table is already shown, then toggle
        var nextRow = table.rows[rowIndex + 1];
        if (nextRow && nextRow.classList.contains('nested-table-row')) {
            // Remove nested table
            table.deleteRow(rowIndex + 1);
            arrow.classList.remove('fa-arrow-down');
            arrow.classList.add('fa-arrow-right');
            document.getElementById('show-button-' + orderId).innerText = "Show";
        } else {
            arrow.classList.remove('fa-arrow-right');
            arrow.classList.add('fa-arrow-down');
            document.getElementById('show-button-' + orderId).innerText = "Hide";

            // Insert new row for nested table
            var nestedTableRow = table.insertRow(rowIndex + 1);
            nestedTableRow.classList.add('nested-table-row');

            // Create first cell for indentation
            var indentCell = nestedTableRow.insertCell(0);
            indentCell.classList.add('indent-cell');

            // Create second cell for the nested table
            var nestedTableCell = nestedTableRow.insertCell(1);
            nestedTableCell.colSpan = "4"; // Span the rest of the columns as needed

            // Create and insert the nested table
            var nestedTable = document.createElement('table');
            {#let products = JSON.parse('{{ products|safe }}');#}
            var nestedTableContent = `
                <tr>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Price</th>
                    <th>Quantity</th>
                </tr>`;
            {#console.log((products));#}
            products[orderId].forEach(function(product) {
                nestedTableContent += `
                    <tr>
                        <td>${product.name}</td>
                        <td>${product.description}</td>
                        <td>€${product.price}</td>
                        <td>${product.quantity}</td>
                    </tr>`;
            });
            nestedTable.innerHTML = nestedTableContent;
            nestedTableCell.appendChild(nestedTable);
        }
    }); // This closing parenthesis was missing
});

</script>
</html>

{% endblock %}

