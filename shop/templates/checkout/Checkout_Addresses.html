{% load static %}
{% load i18n %}
{% load widget_tweaks %}
{% block content %}
<meta charset="UTF-8">
<title>Checkout Addresses</title>
<script src="https://kit.fontawesome.com/yourcode.js" crossorigin="anonymous"></script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet" type="text/css" href="{% static 'css/checkout_cart.css' %}">
<link rel="stylesheet" href="{% static 'css/checkout/checkout_addresses.css' %}">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link rel="stylesheet" href="{% static "css/profile/profile_information.css" %}">
<link rel="stylesheet" href="{% static 'css/SeparateWidgets/addressesWidget.css' %}">
<script src="https://js.stripe.com/v3/"></script>  <!-- new -->
<link rel="icon" href="{% static "images/icons/web-icon.png" %}" type="image/x-icon">
<script src="{% static "js/checkout/totalCalculation.js" %}"></script>

<body>
{% include 'widgets/navigation_bar.html' %}
<div class="all" >
    <div class="page-content" style="width: 100%;">
        <div class="container-steps" >
            <div class="doc-content" style="width: 100%">
                <div class="informational-content">
                    <div class="shopping-cart-label">1. {% trans "Personal Information"%}<hr style="padding: 0;"></div>
                    <div class="shopping-cart-label">2. {% trans "Addresses"%}<hr style="padding: 0;"></div>
                </div>

                <section id="content" class="page-content col-md-12 col-lg-9 myacc_content" style="display: flex; flex-direction: column; margin: auto auto 0 14%;  ">
                    <header class="page-header">
                        <h1 style="margin-bottom: 40px;  color: #0a0a0a">{% trans "Shipping address"%} </h1>
                    </header>
                    <div class="page-addresses">
                        {% for address in my_addresses %}
                            <article id="address-{{ address.address_id }}" class="address" data-id-address="{{ address.address_id }}">
                                <div class="address-content">
                                    <div class="address-body">
                                        <input type="radio" name="shipping_address" id="{{ address.address_id }}" value="{{ address.address_id }}" data-country="{{ address.country }}" class="address-radio">
                                        <div class="address-body">
                                            <h4>{{ address.address_name }}</h4>
                                            <address>
                                                {{ address.first_name }} {{ address.last_name }}
                                                <br>
                                                {{ address.real_address }}
                                                <br>
                                                {{ address.postal_code }} {{ address.city }}
                                                <br>
                                                {{ address.country }}
                                                <br>
                                                {{ address.phone }}
                                            </address>
                                        </div>
                                    </div>
                                    <div class="address-footer">
                                        <a href="{% url "update_address" address_id=address.address_id %}" data-link-action="update-address">
                                            <i>
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><polygon points="16 3 21 8 8 21 3 21 3 16 16 3"></polygon></svg>
                                            </i>
                                            <span>{% trans "Update"%} </span>
                                        </a>
                                        <a href="#" data-link-action="delete-address" data-address-id="{{ address.address_id }}">
                                            <i>
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                                            </i>
                                            <span>{% trans "Delete"%}</span>
                                        </a>
                                    </div>
                                </div>
                            </article>
                        {% endfor %}
                    </div>
                    <div class="addresses-footer" style="display: flex; flex-direction: column">
                        <div class="addressAdd">
                            <a id="addAddressBtn" class="add-address" data-link-action="add-address" style="display: inherit">
                                <i class="material-icons"></i>
                                <span>{% trans "Add new address"%}</span>
                            </a>
                        </div>
                        <div style="margin: 10px 0 ">
                             <a id="toggleAddress" class="address-billing-address">{% trans "Billing address differs from shipping address"%}?</a>
                        </div>
                    </div>

                </section>

                <div id="billingAddresses" style="display: none;">
                        <!-- Similar to the shipping addresses, but with different IDs or classes for distinction -->
                    <section id="content" class="page-content col-md-12 col-lg-9 myacc_content" style="display: flex; flex-direction: column; margin: auto auto 0 14%;  ">
                            <header class="page-header">
                                <h1 style="margin-bottom: 40px;  color: #0a0a0a"> {% trans "Billing address"%}</h1>
                            </header>
                            <div class="page-addresses">
                                {% for address in my_addresses %}
                                    <article id="billing-address-{{ address.address_id }}" class="address billing-address" data-id-address="{{ address.address_id }}">
                                        <div class="address-content">
                                            <div class="address-body">
                                                <input type="radio" name="billing_address" id="{{ address.address_id }}" value="{{ address.address_id }}" data-country="{{ address.country }}" class="address-radio">
                                                <div class="address-body">
                                                    <h4>{{ address.address_name }}</h4>
                                                    <address>
                                                        {{ address.first_name }} {{ address.last_name }}
                                                        <br>
                                                        {{ address.real_address }}
                                                        <br>
                                                        {{ address.postal_code }} {{ address.city }}
                                                        <br>
                                                        {{ address.country }}
                                                        <br>
                                                        {{ address.phone }}
                                                    </address>
                                                </div>
                                            </div>
                                            <div class="address-footer">
                                                <a href="{% url "update_address" address_id=address.address_id %}" data-link-action="update-address">
                                                    <i>
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><polygon points="16 3 21 8 8 21 3 21 3 16 16 3"></polygon></svg>
                                                    </i>
                                                    <span>{% trans "Update"%}</span>
                                                </a>
                                                <a data-link-action="delete-address" data-address-id="{{ address.address_id }}">
                                                    <i>
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                                                    </i>
                                                    <span>{% trans "Delete"%}</span>
                                                </a>
                                            </div>
                                        </div>
                                    </article>
                                {% endfor %}
                            </div>
                            <div class="addresses-footer" style="display: flex; flex-direction: column">
                                <div class="addressAdd">
                                    <a id="addBillingAddressBtn" class="add-address" data-link-action="add-address">
                                        <i class="material-icons"></i>
                                        <span>{% trans "Add new address"%}</span>
                                    </a>
                                </div>
                                <div style="margin: 10px 0">
                                     <a id="toggleBillingAddress" class="address-billing-address">{% trans "Billing address is the same as shipping address"%}</a>
                                </div>
                            </div>
                        </section>
                </div>

            </div>
            <div class="address-form " id="newAddressForm" style="display: none; width: 60%; margin: auto auto 0 14%;">
                <div class="js-address-form">
                    <form method="POST" id="form-address-form" data-id-address="0" data-refresh-url="">
                        <section class="form-fields">
                            <input type="hidden" name="back" value="">
                            <input type="hidden" name="token" value="c87fbdeef3c62a3cece683f5dd3cd320">
                            <div class="form-group row ">
                                <div class="col-md-12">
                                    <label>Alias</label>
                                    <input class="form-control" name="alias" type="text" value="" maxlength="32">
                                </div>
                                <div class="col-md-12 form-control-comment"></div>
                            </div>
                            <div class="form-group row ">
                                <div class="col-md-12 form-control-comment">
                                    <span class="req">*</span>
                                </div>
                                <div class="col-md-12">
                                    <label>{% trans "First name"%}</label>
                                    <input class="form-control" name="firstname" type="text" value="{{ user_ref.first_name }}" maxlength="255" required="">
                                </div>

                            </div>
                            <div class="form-group row ">
                                <div class="col-md-12 form-control-comment">
                                    <span class="req">*</span>
                                </div>
                                <div class="col-md-12">
                                    <label>{% trans "Last name"%}</label>
                                    <input class="form-control" name="lastname" type="text" value="{{ user_ref.last_name }}" maxlength="255" required="">
                                </div>

                            </div>
                            <div class="form-group row ">
                                <div class="col-md-12">
                                    <label>{% trans "Company"%}</label>
                                    <input class="form-control" name="company" type="text" value="" maxlength="255">
                                </div>
                                <div class="col-md-12 form-control-comment"></div>
                            </div>

                            <div class="form-group row ">
                                <div class="col-md-12 form-control-comment">
                                    <span class="req">*</span>
                                </div>
                                <div class="col-md-12">
                                    <label>{% trans "Address"%}</label>
                                    <input class="form-control" name="address1" type="text" value="" maxlength="128" required="">
                                </div>

                            </div>
                            <div class="form-group row ">
                                <div class="col-md-12">
                                    <label>{% trans "Address Complement"%}</label>
                                    <input class="form-control" name="address2" type="text" value="" maxlength="128">
                                </div>
                                <div class="col-md-12 form-control-comment"></div>
                            </div>
                            <div class="form-group row ">
                                <div class="col-md-12 form-control-comment">
                                    <span class="req">*</span>
                                </div>
                                <div class="col-md-12">
                                    <label>{% trans "Postal Code"%}</label>
                                    <input class="form-control" name="postcode" type="text" value="" maxlength="12" required="">
                                </div>

                            </div>
                            <div class="form-group row ">
                                <div class="col-md-12 form-control-comment">
                                    <span class="req">*</span>
                                </div>
                                <div class="col-md-12">
                                    <label>{% trans "City"%}</label>
                                    <input class="form-control" name="city" type="text" value="" maxlength="64" required="">
                                </div>

                            </div>
                            <div class="form-group row ">
                                <div class="col-md-12 form-control-comment">
                                    <span class="req">*</span>
                                </div>
                                <div class="col-md-12">
                                    <label>{% trans "Country"%}</label>
                                    <select class="form-control form-control-select js-country" name="id_country" required="">
                                        <option value="" disabled="" selected="">-- please choose --</option>
                                        <!-- Country options go here -->
                                        <option value="231">Afghanistan</option><option value="244">Åland Islands</option><option value="230">Albania</option><option value="38">Algeria</option><option value="39">American Samoa</option><option value="40">Andorra</option><option value="41">Angola</option><option value="42">Anguilla</option><option value="232">Antarctica</option><option value="43">Antigua and Barbuda</option><option value="44">Argentina</option><option value="45">Armenia</option><option value="46">Aruba</option><option value="24">Australia</option><option value="2" >Austria</option><option value="47">Azerbaijan</option><option value="48">Bahamas</option><option value="49">Bahrain</option><option value="50">Bangladesh</option><option value="51">Barbados</option><option value="52">Belarus</option><option value="3">Belgium</option><option value="53">Belize</option><option value="54">Benin</option><option value="55">Bermuda</option><option value="56">Bhutan</option><option value="34">Bolivia</option><option value="233">Bosnia and Herzegovina</option><option value="57">Botswana</option><option value="234">Bouvet Island</option><option value="58">Brazil</option><option value="235">British Indian Ocean Territory</option><option value="59">Brunei</option><option value="236">Bulgaria</option><option value="60">Burkina Faso</option><option value="61">Burma (Myanmar)</option><option value="62">Burundi</option><option value="63">Cambodia</option><option value="64">Cameroon</option><option value="4">Canada</option><option value="65">Cape Verde</option><option value="237">Cayman Islands</option><option value="66">Central African Republic</option><option value="67">Chad</option><option value="68">Chile</option><option value="5">China</option><option value="238">Christmas Island</option><option value="239">Cocos (Keeling) Islands</option><option value="69">Colombia</option><option value="70">Comoros</option><option value="71">Congo, Dem. Republic</option><option value="72">Congo, Republic</option><option value="240">Cook Islands</option><option value="73">Costa Rica</option><option value="74">Croatia</option><option value="75">Cuba</option><option value="76">Cyprus</option><option value="16">Czech Republic</option><option value="20">Denmark</option><option value="77">Djibouti</option><option value="78">Dominica</option><option value="79">Dominican Republic</option><option value="80">East Timor</option><option value="81">Ecuador</option><option value="82">Egypt</option><option value="83">El Salvador</option><option value="84">Equatorial Guinea</option><option value="85">Eritrea</option><option value="86">Estonia</option><option value="87">Ethiopia</option><option value="88">Falkland Islands</option><option value="89">Faroe Islands</option><option value="90">Fiji</option><option value="7">Finland</option><option value="8">France</option><option value="241">French Guiana</option><option value="242">French Polynesia</option><option value="243">French Southern Territories</option><option value="91">Gabon</option><option value="92">Gambia</option><option value="93">Georgia</option><option value="1">Germany</option><option value="94">Ghana</option><option value="97">Gibraltar</option><option value="9">Greece</option><option value="96">Greenland</option><option value="95">Grenada</option><option value="98">Guadeloupe</option><option value="99">Guam</option><option value="100">Guatemala</option><option value="101">Guernsey</option><option value="102">Guinea</option><option value="103">Guinea-Bissau</option><option value="104">Guyana</option><option value="105">Haiti</option><option value="106">Heard Island and McDonald Islands</option><option value="108">Honduras</option><option value="22">HongKong</option><option value="143">Hungary</option><option value="109">Iceland</option><option value="110">India</option><option value="111">Indonesia</option><option value="112">Iran</option><option value="113">Iraq</option><option value="26">Ireland</option><option value="29">Israel</option><option value="10">Italy</option><option value="32">Ivory Coast</option><option value="115">Jamaica</option><option value="11">Japan</option><option value="116">Jersey</option><option value="117">Jordan</option><option value="118">Kazakhstan</option><option value="119">Kenya</option><option value="120">Kiribati</option><option value="121">Korea, Dem. Republic of</option><option value="122">Kuwait</option><option value="123">Kyrgyzstan</option><option value="124">Laos</option><option value="125">Latvia</option><option value="126">Lebanon</option><option value="127">Lesotho</option><option value="128">Liberia</option><option value="129">Libya</option><option value="130">Liechtenstein</option><option value="131">Lithuania</option><option value="12">Luxemburg</option><option value="132">Macau</option><option value="133">Macedonia</option><option value="134">Madagascar</option><option value="135">Malawi</option><option value="136">Malaysia</option><option value="137">Maldives</option><option value="138">Mali</option><option value="139">Malta</option><option value="114">Man Island</option><option value="140">Marshall Islands</option><option value="141">Martinique</option><option value="142">Mauritania</option><option value="35">Mauritius</option><option value="144">Mayotte</option><option value="145">Mexico</option><option value="146">Micronesia</option><option value="147">Moldova</option><option value="148">Monaco</option><option value="149">Mongolia</option><option value="150">Montenegro</option><option value="151">Montserrat</option><option value="152">Morocco</option><option value="153">Mozambique</option><option value="154">Namibia</option><option value="155">Nauru</option><option value="156">Nepal</option><option value="13">Netherlands</option><option value="157">Netherlands Antilles</option><option value="158">New Caledonia</option><option value="27">New Zealand</option><option value="159">Nicaragua</option><option value="160">Niger</option><option value="31">Nigeria</option><option value="161">Niue</option><option value="162">Norfolk Island</option><option value="245">Northern Ireland</option><option value="163">Northern Mariana Islands</option><option value="23">Norway</option><option value="164">Oman</option><option value="165">Pakistan</option><option value="166">Palau</option><option value="167">Palestinian Territories</option><option value="168">Panama</option><option value="169">Papua New Guinea</option><option value="170">Paraguay</option><option value="171">Peru</option><option value="172">Philippines</option><option value="173">Pitcairn</option><option value="14">Poland</option><option value="15">Portugal</option><option value="174">Puerto Rico</option><option value="175">Qatar</option><option value="176">Reunion Island</option><option value="36">Romania</option><option value="177">Russian Federation</option><option value="178">Rwanda</option><option value="179">Saint Barthelemy</option><option value="180">Saint Kitts and Nevis</option><option value="181">Saint Lucia</option><option value="182">Saint Martin</option><option value="183">Saint Pierre and Miquelon</option><option value="184">Saint Vincent and the Grenadines</option><option value="185">Samoa</option><option value="186">San Marino</option><option value="187">São Tomé and Príncipe</option><option value="188">Saudi Arabia</option><option value="189">Senegal</option><option value="190">Serbia</option><option value="191">Seychelles</option><option value="192">Sierra Leone</option><option value="25">Singapore</option><option value="37">Slovakia</option><option value="193">Slovenia</option><option value="194">Solomon Islands</option><option value="195">Somalia</option><option value="30">South Africa</option><option value="196">South Georgia and the South Sandwich Islands</option><option value="28">South Korea</option><option value="6">Spain</option><option value="197">Sri Lanka</option><option value="198">Sudan</option><option value="199">Suriname</option><option value="200">Svalbard and Jan Mayen</option><option value="201">Swaziland</option><option value="18">Sweden</option><option value="19">Switzerland</option><option value="202">Syria</option><option value="203">Taiwan</option><option value="204">Tajikistan</option><option value="205">Tanzania</option><option value="206">Thailand</option><option value="33">Togo</option><option value="207">Tokelau</option><option value="208">Tonga</option><option value="209">Trinidad and Tobago</option><option value="210">Tunisia</option><option value="211">Turkey</option><option value="212">Turkmenistan</option><option value="213">Turks and Caicos Islands</option><option value="214">Tuvalu</option><option value="215">Uganda</option><option value="216">Ukraine</option><option value="217">United Arab Emirates</option><option value="17">United Kingdom</option><option value="21">United States</option><option value="218">Uruguay</option><option value="219">Uzbekistan</option><option value="220">Vanuatu</option><option value="107">Vatican City State</option><option value="221">Venezuela</option><option value="222">Vietnam</option><option value="223">Virgin Islands (British)</option><option value="224">Virgin Islands (U.S.)</option><option value="225">Wallis and Futuna</option><option value="226">Western Sahara</option><option value="227">Yemen</option><option value="228">Zambia</option><option value="229">Zimbabwe</option>
                                    </select>
                                </div>

                            </div>
                            <div class="form-group row ">
                                <div class="col-md-12 form-control-comment">
                                    <span class="req">*</span>
                                </div>
                                <div class="col-md-12">
                                    <label>{% trans "Phone"%}</label>
                                    <input class="form-control" name="phone" type="tel" value="" maxlength="32" required="">
                                </div>

                            </div>
                        </section>
                        <footer class="form-footer clearfix" style="display: flex;">
{#                            <input type="hidden" name="submitAddress" value="1">#}
                            <button class="btn btn-primary float-xs-right" id="cancelBtn" style="margin-right: 40px"> {% trans "Cancel"%} </button>
                            <button class="btn btn-primary float-xs-right" type="submit"> {% trans "Save" %} </button>
                        </footer>
                    </form>
                </div>
            </div>

                <button style="width: 80%;  margin: auto auto 0 14%;text-align: center;" class="btn btn-primary wide form-control-submit float-xs-right" id="continueCheckoutBtn"> {% trans "Continue"%} </button>

            </div>
        {% include "checkout/checkout_widget.html" %}
    </div>
</div>
{% include "widgets/overlay.html" %}
</body>
<script>
let countrys_vat = {'Afghanistan': 0, 'Åland Islands': 0, 'Albania': 0, 'Algeria': 0, 'American Samoa': 0, 'Andorra': 0, 'Angola': 0, 'Anguilla': 0, 'Antarctica': 0, 'Antigua and Barbuda': 0, 'Argentina': 0, 'Armenia': 0, 'Aruba': 0, 'Australia': 0, 'Austria': 20, 'Azerbaijan': 0, 'Bahamas': 0, 'Bahrain': 0, 'Bangladesh': 0, 'Barbados': 0, 'Belarus': 0, 'Belgium': 21, 'Belize': 0, 'Benin': 0, 'Bermuda': 0, 'Bhutan': 0, 'Bolivia': 0, 'Bosnia and Herzegovina': 0, 'Botswana': 0, 'Bouvet Island': 0, 'Brazil': 0, 'British Indian Ocean Territory': 0, 'Brunei': 0, 'Bulgaria': 20, 'Burkina Faso': 0, 'Burma (Myanmar)': 0, 'Burundi': 0, 'Cambodia': 0, 'Cameroon': 0, 'Canada': 0, 'Cape Verde': 0, 'Cayman Islands': 0, 'Central African Republic': 0, 'Chad': 0, 'Chile': 0, 'China': 0, 'Christmas Island': 0, 'Cocos (Keeling) Islands': 0, 'Colombia': 0, 'Comoros': 0, 'Congo, Dem. Republic': 0, 'Congo, Republic': 0, 'Cook Islands': 0, 'Costa Rica': 0, 'Croatia': 25, 'Cuba': 0, 'Cyprus': 19, 'Czech Republic': 21, 'Denmark': 25, 'Djibouti': 0, 'Dominica': 0, 'Dominican Republic': 0, 'East Timor': 0, 'Ecuador': 0, 'Egypt': 0, 'El Salvador': 0, 'Equatorial Guinea': 0, 'Eritrea': 0, 'Estonia': 22, 'Ethiopia': 0, 'Falkland Islands': 0, 'Faroe Islands': 0, 'Fiji': 0, 'Finland': 24, 'France': 20, 'French Guiana': 0, 'French Polynesia': 0, 'French Southern Territories': 0, 'Gabon': 0, 'Gambia': 0, 'Georgia': 0, 'Germany': 19, 'Ghana': 0, 'Gibraltar': 0, 'Greece': 24, 'Greenland': 0, 'Grenada': 0, 'Guadeloupe': 0, 'Guam': 0, 'Guatemala': 0, 'Guernsey': 0, 'Guinea': 0, 'Guinea-Bissau': 0, 'Guyana': 0, 'Haiti': 0, 'Heard Island and McDonald Islands': 0, 'Honduras': 0, 'HongKong': 0, 'Hungary': 27, 'Iceland': 0, 'India': 0, 'Indonesia': 0, 'Iran': 0, 'Iraq': 0, 'Ireland': 23, 'Israel': 0, 'Italy': 22, 'Ivory Coast': 0, 'Jamaica': 0, 'Japan': 0, 'Jersey': 0, 'Jordan': 0, 'Kazakhstan': 0, 'Kenya': 0, 'Kiribati': 0, 'Dem. Republic of Korea': 0, 'Kuwait': 0, 'Kyrgyzstan': 0, 'Laos': 0, 'Latvia': 21, 'Lebanon': 0, 'Lesotho': 0, 'Liberia': 0, 'Libya': 0, 'Liechtenstein': 8.1, 'Lithuania': 21, 'Luxemburg': 0, 'Macau': 0, 'Macedonia': 0, 'Madagascar': 0, 'Malawi': 0, 'Malaysia': 0, 'Maldives': 0, 'Mali': 0, 'Malta': 18, 'Man Island': 0, 'Marshall Islands': 0, 'Martinique': 0, 'Mauritania': 0, 'Mauritius': 0, 'Mayotte': 0, 'Mexico': 0, 'Micronesia': 0, 'Moldova': 0, 'Monaco': 20, 'Mongolia': 0, 'Montenegro': 0, 'Montserrat': 0, 'Morocco': 0, 'Mozambique': 0, 'Namibia': 0, 'Nauru': 0, 'Nepal': 0, 'Netherlands': 21, 'Netherlands Antilles': 0, 'New Caledonia': 0, 'New Zealand': 0, 'Nicaragua': 0, 'Niger': 0, 'Nigeria': 0, 'Niue': 0, 'Norfolk Island': 0, 'Northern Ireland': 0, 'Northern Mariana Islands': 0, 'Norway': 0, 'Oman': 0, 'Pakistan': 0, 'Palau': 0, 'Palestinian Territories': 0, 'Panama': 0, 'Papua New Guinea': 0, 'Paraguay': 0, 'Peru': 0, 'Philippines': 0, 'Pitcairn': 0, 'Poland': 23, 'Portugal': 23, 'Puerto Rico': 0, 'Qatar': 0, 'Reunion Island': 0, 'Romania': 19, 'Russian Federation': 0, 'Rwanda': 0, 'Saint Barthelemy': 0, 'Saint Kitts and Nevis': 0, 'Saint Lucia': 0, 'Saint Martin': 0, 'Saint Pierre and Miquelon': 0, 'Saint Vincent and the Grenadines': 0, 'Samoa': 0, 'San Marino': 0, 'São Tomé and Príncipe': 0, 'Saudi Arabia': 0, 'Senegal': 0, 'Serbia': 0, 'Seychelles': 0, 'Sierra Leone': 0, 'Singapore': 0, 'Slovakia': 20, 'Slovenia': 22, 'Solomon Islands': 0, 'Somalia': 0, 'South Africa': 0, 'South Georgia and the South Sandwich Islands': 0, 'South Korea': 0, 'Spain': 21, 'Sri Lanka': 0, 'Sudan': 0, 'Suriname': 0, 'Svalbard and Jan Mayen': 0, 'Swaziland': 0, 'Sweden': 25, 'Switzerland': 8.1, 'Syria': 0, 'Taiwan': 0, 'Tajikistan': 0, 'Tanzania': 0, 'Thailand': 0, 'Togo': 0, 'Tokelau': 0, 'Tonga': 0, 'Trinidad and Tobago': 0, 'Tunisia': 0, 'Turkey': 0, 'Turkmenistan': 0, 'Turks and Caicos Islands': 0, 'Tuvalu': 0, 'Uganda': 0, 'Ukraine': 0, 'United Arab Emirates': 0, 'United Kingdom': 20, 'United States': 0, 'Uruguay': 0, 'Uzbekistan': 0, 'Vanuatu': 0, 'Vatican City State': 0, 'Venezuela': 0, 'Vietnam': 0, 'Virgin Islands (British)': 0, 'Virgin Islands (U.S.)': 0, 'Wallis and Futuna': 0, 'Western Sahara': 0, 'Yemen': 0, 'Zambia': 0, 'Zimbabwe': 0};


let selectedShippingAddressId = null;
let selectedBillingAddressCountry = "";
let selectedBillingAddressId = "false";
let customer_type = "{{ customer_type }}"
document.getElementById('addBillingAddressBtn').addEventListener('click', function() {
    this.style.display = "none";
    document.getElementById('newAddressForm').style.display = 'block';
});


document.getElementById('toggleBillingAddress').addEventListener('click', function() {
    const currentShippingRadio = document.getElementById(selectedShippingAddressId);
    calculate_final(countrys_vat[currentShippingRadio.getAttribute('data-country')], currency, documentss);
    let billingSection = document.getElementById('billingAddresses');
    this.style.display = "none";
    displayBillingAddresses(selectedShippingAddressId);
    document.getElementById('addBillingAddressBtn').style.display = 'none';
    document.getElementById('addAddressBtn').style.display = 'inherit';
    document.getElementById('toggleAddress').style.display = "initial";
    billingSection.style.display = 'none';
    selectedBillingAddressId = "false";
});


function displayBillingAddresses(excludeId) {
    document.querySelectorAll('.billing-address').forEach(address => {
        if (address.dataset.idAddress === excludeId) {
            address.style.display = 'none';
        } else {
            address.style.display = 'block';
        }
    });
}


document.querySelectorAll('input[name="shipping_address"]').forEach(radio => {
    radio.addEventListener('change', function() {
        selectedShippingAddressId = this.value;
        if(selectedBillingAddressId ==="false"){
            document.getElementById('cart-total').querySelector('.label-total').textContent = "{% trans "Total"  %}" + "(VAT incl.)"
            document.getElementById("cart-taxes").style.display = "block";
            calculate_final(countrys_vat[this.getAttribute('data-country')], currency, documentss);
        }

    });
});
document.querySelectorAll('input[name="billing_address"]').forEach(radio => {
    radio.addEventListener('change', function() {
        selectedBillingAddressId = this.value;
        document.getElementById("cart-taxes").style.display = "block";
        calculate_final(countrys_vat[this.getAttribute('data-country')], currency, documentss);

    });
});


document.getElementById('toggleAddress').addEventListener('click', function() {

    let billingSection = document.getElementById('billingAddresses');

    if (billingSection.style.display === 'none') {
        if(selectedShippingAddressId==null){
            alert("{{ _("Please select a shipping address first")|escapejs }}");
            return;
        }
        this.style.display = "none";
        displayBillingAddresses(selectedShippingAddressId);
        document.getElementById('addAddressBtn').style.display = 'none';
        document.getElementById('addBillingAddressBtn').style.display = 'inherit';
        document.getElementById('toggleBillingAddress').style.display = "initial";
        billingSection.style.display = 'block';
    } else {
        billingSection.style.display = 'none';
    }
    selectedBillingAddressId = "true";
});


document.getElementById('addAddressBtn').addEventListener('click', function() {
    this.style.display = "none";
    document.getElementById('newAddressForm').style.display = 'block';
    document.getElementById('toggleAddress').style.display = "none";
    document.getElementById('continueCheckoutBtn').style.display = "none";
});
document.getElementById('addBillingAddressBtn').addEventListener('click', function() {
    this.style.display = "none";
    document.getElementById('newAddressForm').style.display = 'block';
    document.getElementById('toggleBillingAddress').style.display = "none";
    document.getElementById('continueCheckoutBtn').style.display = "none";
});
document.getElementById('cancelBtn').addEventListener('click', function() {
    document.getElementById('newAddressForm').style.display = 'none';
    document.getElementById('continueCheckoutBtn').style.display = "block";
    if(document.getElementById('billingAddresses').style.display === "none"){

        document.getElementById('addAddressBtn').style.display = 'inherit';
        document.getElementById('toggleAddress').style.display = "initial";

    }
    else{

        document.getElementById('addBillingAddressBtn').style.display = 'inherit';
        document.getElementById('toggleBillingAddress').style.display = "initial";
    }

});
let documentss = [];
function init() {
    documentss = {{ documents|safe }};
    calculate_final(0, currency, documentss);
}

document.addEventListener("DOMContentLoaded", function() {
    hideOverlay();
    isCheckout = true;
     init();
});


// Initial placement of the underline
document.getElementById('form-address-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData(document.getElementById('form-address-form'));
    const jsonObject = {
        address_data: Object.fromEntries(formData.entries())
    };
    const csrftoken = getCookie('csrftoken');
    fetch('{% url "create_address" %}', { // Ensure the URL is correct
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrftoken,
        },
        body: JSON.stringify(jsonObject),
    })
    .then(response => response.json())
    .then(data => {
        console.log(data);
        alert("{{ _("The address has been successfully added!")|escapejs }}");
        window.location.reload(true);
    }).catch(error => console.error('Error:', error));
    document.getElementById('continueCheckoutBtn').style.display = "none";
});
document.addEventListener("click", function(e) {
    if (e.target.dataset.linkAction === "delete-address" || e.target.closest("[data-link-action='delete-address']")) {
        e.preventDefault(); // Prevent the default behavior
        const deleteButton = e.target.closest("[data-link-action='delete-address']");
        const addressId = deleteButton.dataset.addressId;
        const addressElement = document.getElementById(`address-${addressId}`);
        const csrftoken = getCookie('csrftoken');

        // Confirm deletion
        if (!confirm("{{ _("Are you sure you want to delete this address?")|escapejs }}")) {
            return;
        }

        // Construct the URL for deletion
        const url = `/profile/addresses/delete_address/${addressId}/`; // Adjust based on your URL pattern

        fetch(url, {
            method: 'POST',
            headers: {
                'X-CSRFToken': csrftoken,
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ address_id: addressId })
        })
        .then(response => response.json())
        .then(data => {
        if(data.status === 'success') {
            // Fade out first
            addressElement.style.opacity = '0';
            addressElement.addEventListener('transitionend', function fadeOutComplete() {
                addressElement.removeEventListener('transitionend', fadeOutComplete);
                // Now collapse
                addressElement.style.height = '0';
                addressElement.style.padding = '0';
                addressElement.style.margin = '0';

                addressElement.addEventListener('transitionend', function collapseComplete() {
                    // This part changes:
                    // Instead of removing immediately, we use a timeout to ensure the
                    // CSS transitions have a moment to reflow the layout
                    setTimeout(() => {
                        addressElement.remove();
                        // Optionally, trigger a reflow of any JS-based layout or UI components here
                    }, 500); // This delay should match your longest transition duration
                }, { once: true });
            }, { once: true });
        } else {
            alert("Error deleting address: " + data.message);
        }
    })
        .catch(error => console.error('Error:', error));
    }
});
document.getElementById('continueCheckoutBtn').addEventListener('click', function (){
    console.log("Billing Address: " + selectedBillingAddressId);
    console.log("Shipping Address: " + selectedShippingAddressId);
    if(selectedShippingAddressId!==null){
        if(selectedBillingAddressId==="false" || selectedBillingAddressId!=="true"){
             let vat = ""
             if(selectedBillingAddressId === "false"){
                const currentShippingRadio = document.getElementById(selectedShippingAddressId);
                vat = countrys_vat[currentShippingRadio.getAttribute('data-country')]
             }
             else{
                const currentShippingRadio = document.getElementById(selectedBillingAddressId);
                vat = countrys_vat[currentShippingRadio.getAttribute('data-country')]
             }
             if (documentss.length !== 0){
                 let addresses_properties = { vat: vat, shippingAddress: selectedShippingAddressId };
                 addresses_properties['billingAddress'] = selectedBillingAddressId === "false" ? selectedShippingAddressId : selectedBillingAddressId;

                 if(customer_type === "Customer"){
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = "{% url 'checkout_payment_type' %}";

                    // Добавляем CSRF-токен
                    const csrfToken = getCookie('csrftoken');  // Предположим, у вас есть функция для получения CSRF токена
                    const csrfInput = document.createElement('input');
                    csrfInput.type = 'hidden';
                    csrfInput.name = 'csrfmiddlewaretoken';
                    csrfInput.value = csrfToken;
                    form.appendChild(csrfInput);

                    // Добавляем форму на страницу и отправляем
                    const addressesInput = document.createElement('input');
                    addressesInput.type = 'hidden';
                    addressesInput.name = 'addresses_properties';
                    addressesInput.value = JSON.stringify(addresses_properties);
                    form.appendChild(addressesInput);

                    // Добавляем форму на страницу и отправляем
                    document.body.appendChild(form);
                    form.submit();

                    // Отправляем форму и получаем session ID от сервера

                 }
                 else{
                     window.alert("{{ _("Order will be delivered to your email")|escapejs }}");
                     showOverlay();
                     fetch('{% url 'send_email'%}', {
                         method: 'POST',
                         headers: {
                             'X-CSRFToken': getCookie('csrftoken'),
                             'Content-Type': 'application/json',
                         },
                         body: JSON.stringify(addresses_properties)
                     })
                     .then(response => response.json())
                     .then(data => {
                         console.log(data);
                         if (data.status === 'success') {
                             // Redirect to the home URL
                             window.location.href = '{% url 'home' %}';
                         } else {
                             // Handle error or unsuccessful status
                             console.error('Error in processing the order');
                         }
                     })
                     .catch(error => console.error('Error:', error))
                     .finally(() => {
                        // This will execute after fetch is complete, regardless of the outcome
                        hideOverlay();
                     });
                 }

             }
            else
             {
                 window.alert("{{ _("You have to add at least 1 item to finish order")|escapejs }}");
             }
        }
        else{
            window.alert("{{ _("You didn't provide billing address")|escapejs }}");
        }
    }
    else{
        window.alert("{{ _("You didn't provide shipping address")|escapejs }}");
    }
});
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
</script>
{% endblock %}